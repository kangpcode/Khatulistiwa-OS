# ============================================================================
# grub.cfg - GRUB Configuration untuk Khatulistiwa OS
# Copyright (c) 2025 Dhafa Nazula Permadi & Team BIGCode By Cv Bintang Gumilang Group
# ============================================================================
# 
# GRUB Configuration dengan fitur:
# 1. Multi-platform boot support
# 2. Cultural boot themes
# 3. Traditional Indonesian boot options
# 4. Spiritual boot protection
# 5. Legacy system compatibility
# 6. Advanced boot parameters

# GRUB timeout (10 seconds)
set timeout=10
set default=0

# Cultural theme settings
set theme_name="Khatulistiwa"
set cultural_mode="enabled"
set spiritual_protection="enabled"

# Boot resolution
set gfxmode=1024x768x32,800x600x32,auto
set gfxpayload=keep

# Terminal settings
terminal_output gfxterm
terminal_input console

# Load video modules
insmod all_video
insmod gfxterm
insmod png
insmod jpeg

# Cultural background and theme
if loadfont /boot/fonts/unicode.pf2 ; then
    set gfxmode=auto
    insmod gfxterm
    insmod png
    if background_image /boot/themes/khatulistiwa/background.png ; then
        set color_normal=white/black
        set color_highlight=yellow/red
    else
        set menu_color_normal=cyan/blue
        set menu_color_highlight=white/blue
    fi
fi

# Cultural boot messages
echo "==============================================================================="
echo "                        KHATULISTIWA OS BOOTLOADER                           "
echo "                               GRUB v2.0.0                                  "
echo "                                                                             "
echo "              Teknologi Modern dengan Jiwa Indonesia                       "
echo "                                                                             "
echo "              (c) 2025 Dhafa Nazula Permadi & Team BIGCode By Cv Bintang Gumilang Group                   "
echo "==============================================================================="
echo ""
echo "Selamat datang di Khatulistiwa OS!"
echo "Pilih opsi boot dengan berkah..."
echo ""

# Main Khatulistiwa OS boot entry
menuentry 'Khatulistiwa OS (Default)' --class khatulistiwa --class gnu-linux --class gnu --class os {
    echo "Memulai Khatulistiwa OS dengan berkah..."
    echo "Bismillahirrahmanirrahim..."
    echo ""
    
    # Set boot parameters
    set root='hd0,msdos1'
    
    # Cultural boot blessing
    echo "Mengaktifkan perlindungan spiritual..."
    echo "Garuda Pancasila melindungi sistem ini..."
    echo "Dengan semangat Bhinneka Tunggal Ika..."
    echo ""
    
    # Load kernel with cultural parameters
    linux /boot/khatkernel.khat root=/dev/sda1 \
          cultural_mode=enabled \
          spiritual_protection=enabled \
          gotong_royong=enabled \
          traditional_ui=enabled \
          gamelan_audio=enabled \
          batik_themes=enabled \
          adat_security=enabled \
          quiet splash
    
    # Load initial ramdisk
    initrd /boot/khat_initrd.img
    
    echo "Semoga boot berhasil dengan lancar!"
}

# Khatulistiwa OS Safe Mode
menuentry 'Khatulistiwa OS (Safe Mode - Mode Aman)' --class khatulistiwa --class recovery {
    echo "Memulai Khatulistiwa OS dalam mode aman..."
    echo "Mode aman dengan perlindungan spiritual..."
    echo ""
    
    set root='hd0,msdos1'
    
    # Safe mode with minimal cultural features
    linux /boot/khatkernel.khat root=/dev/sda1 \
          cultural_mode=minimal \
          spiritual_protection=enabled \
          safe_mode=enabled \
          debug=enabled \
          single
    
    initrd /boot/khat_initrd.img
    
    echo "Boot mode aman dimulai..."
}

# Khatulistiwa OS Recovery Mode
menuentry 'Khatulistiwa OS (Recovery - Pemulihan)' --class khatulistiwa --class recovery {
    echo "Memulai mode pemulihan Khatulistiwa OS..."
    echo "Dengan berkah untuk pemulihan sistem..."
    echo ""
    
    set root='hd0,msdos1'
    
    # Recovery mode with full spiritual protection
    linux /boot/khatkernel.khat root=/dev/sda1 \
          recovery_mode=enabled \
          spiritual_protection=maximum \
          cultural_validation=enabled \
          debug=verbose \
          init=/bin/recovery_shell
    
    initrd /boot/khat_recovery.img
    
    echo "Mode pemulihan dengan perlindungan spiritual maksimal..."
}

# Cultural Demo Mode
menuentry 'Khatulistiwa OS (Cultural Demo - Demo Budaya)' --class khatulistiwa --class demo {
    echo "Memulai demo budaya Khatulistiwa OS..."
    echo "Menampilkan semua fitur budaya Indonesia..."
    echo ""
    
    set root='hd0,msdos1'
    
    # Demo mode with all cultural features enabled
    linux /boot/khatkernel.khat root=/dev/sda1 \
          demo_mode=enabled \
          cultural_mode=maximum \
          spiritual_protection=enabled \
          gotong_royong=enabled \
          traditional_ui=maximum \
          gamelan_audio=enabled \
          wayang_animations=enabled \
          batik_themes=all \
          javanese_calendar=enabled \
          islamic_calendar=enabled \
          traditional_apps=all \
          cultural_validation=strict
    
    initrd /boot/khat_demo.img
    
    echo "Demo budaya Indonesia dimulai!"
}

# Legacy BIOS Compatibility
menuentry 'Khatulistiwa OS (Legacy BIOS)' --class khatulistiwa --class legacy {
    echo "Memulai Khatulistiwa OS untuk sistem legacy..."
    echo "Kompatibilitas dengan sistem lama..."
    echo ""
    
    set root='hd0,msdos1'
    
    # Legacy mode with basic features
    linux /boot/khatkernel.khat root=/dev/sda1 \
          legacy_mode=enabled \
          cultural_mode=basic \
          spiritual_protection=enabled \
          acpi=off \
          noapic \
          nolapic \
          vga=normal
    
    initrd /boot/khat_legacy.img
    
    echo "Boot legacy dengan berkah..."
}

# Multi-platform boot options
submenu 'Platform Khusus (Special Platforms)' {
    
    # ARM64 boot option
    menuentry 'Khatulistiwa OS (ARM64)' --class khatulistiwa --class arm {
        echo "Memulai Khatulistiwa OS untuk ARM64..."
        echo "Platform ARM dengan jiwa Indonesia..."
        echo ""
        
        set root='hd0,gpt1'
        
        linux /boot/khatkernel_arm64.khat root=/dev/mmcblk0p1 \
              platform=arm64 \
              cultural_mode=enabled \
              spiritual_protection=enabled \
              devicetree=/boot/khat_arm64.dtb
        
        initrd /boot/khat_arm64.img
        
        echo "ARM64 boot dengan berkah Nusantara..."
    }
    
    # RISC-V boot option
    menuentry 'Khatulistiwa OS (RISC-V)' --class khatulistiwa --class riscv {
        echo "Memulai Khatulistiwa OS untuk RISC-V..."
        echo "Platform RISC-V dengan teknologi Indonesia..."
        echo ""
        
        set root='hd0,gpt1'
        
        linux /boot/khatkernel_riscv.khat root=/dev/vda1 \
              platform=riscv \
              cultural_mode=enabled \
              spiritual_protection=enabled \
              opensbi=/boot/opensbi.bin
        
        initrd /boot/khat_riscv.img
        
        echo "RISC-V boot dengan inovasi Indonesia..."
    }
    
    # Virtual Machine optimized
    menuentry 'Khatulistiwa OS (Virtual Machine)' --class khatulistiwa --class vm {
        echo "Memulai Khatulistiwa OS untuk Virtual Machine..."
        echo "Optimasi untuk lingkungan virtual..."
        echo ""
        
        set root='hd0,msdos1'
        
        linux /boot/khatkernel.khat root=/dev/sda1 \
              vm_mode=enabled \
              cultural_mode=enabled \
              spiritual_protection=enabled \
              virtio=enabled \
              clocksource=tsc \
              elevator=noop
        
        initrd /boot/khat_vm.img
        
        echo "Virtual machine boot dengan berkah..."
    }
}

# Advanced boot options
submenu 'Opsi Lanjutan (Advanced Options)' {
    
    # Debug mode
    menuentry 'Khatulistiwa OS (Debug Mode)' --class khatulistiwa --class debug {
        echo "Memulai mode debug Khatulistiwa OS..."
        echo "Mode debug dengan logging lengkap..."
        echo ""
        
        set root='hd0,msdos1'
        
        linux /boot/khatkernel.khat root=/dev/sda1 \
              debug_mode=enabled \
              cultural_debug=enabled \
              spiritual_debug=enabled \
              loglevel=7 \
              debug \
              ignore_loglevel \
              console=tty0 \
              console=ttyS0,115200
        
        initrd /boot/khat_debug.img
        
        echo "Debug mode dengan perlindungan spiritual..."
    }
    
    # Minimal mode
    menuentry 'Khatulistiwa OS (Minimal)' --class khatulistiwa --class minimal {
        echo "Memulai mode minimal Khatulistiwa OS..."
        echo "Sistem minimal dengan fitur inti..."
        echo ""
        
        set root='hd0,msdos1'
        
        linux /boot/khatkernel.khat root=/dev/sda1 \
              minimal_mode=enabled \
              cultural_mode=basic \
              spiritual_protection=basic \
              init=/bin/minimal_init
        
        initrd /boot/khat_minimal.img
        
        echo "Mode minimal dengan berkah..."
    }
    
    # Network boot
    menuentry 'Khatulistiwa OS (Network Boot)' --class khatulistiwa --class network {
        echo "Memulai network boot Khatulistiwa OS..."
        echo "Boot melalui jaringan gotong royong..."
        echo ""
        
        set root='(tftp)'
        
        linux (tftp)/khatkernel.khat root=/dev/nfs \
              netboot=enabled \
              cultural_mode=enabled \
              spiritual_protection=enabled \
              gotong_royong_network=enabled \
              ip=dhcp \
              nfsroot=192.168.1.100:/khatulistiwa
        
        initrd (tftp)/khat_netboot.img
        
        echo "Network boot dengan semangat gotong royong..."
    }
}

# Cultural boot ceremonies
submenu 'Upacara Boot (Boot Ceremonies)' {
    
    # Full ceremony boot
    menuentry 'Boot dengan Upacara Lengkap' --class khatulistiwa --class ceremony {
        echo "Memulai boot dengan upacara lengkap..."
        echo "Upacara tradisional Indonesia..."
        echo ""
        echo "Bismillahirrahmanirrahim..."
        sleep 1
        echo "Dengan ridho Allah SWT..."
        sleep 1
        echo "Dan berkah Pancasila..."
        sleep 1
        echo "Garuda Pancasila melindungi..."
        sleep 1
        echo "Bhinneka Tunggal Ika..."
        sleep 1
        echo "Gotong royong untuk semua..."
        sleep 2
        
        set root='hd0,msdos1'
        
        linux /boot/khatkernel.khat root=/dev/sda1 \
              ceremony_mode=full \
              cultural_mode=maximum \
              spiritual_protection=maximum \
              traditional_blessing=enabled \
              boot_ceremony=complete
        
        initrd /boot/khat_ceremony.img
        
        echo "Upacara boot selesai dengan berkah!"
    }
    
    # Quick blessing boot
    menuentry 'Boot dengan Berkah Singkat' --class khatulistiwa --class blessing {
        echo "Memulai boot dengan berkah singkat..."
        echo "Bismillahirrahmanirrahim..."
        echo "Semoga berkah untuk semua..."
        sleep 1
        
        set root='hd0,msdos1'
        
        linux /boot/khatkernel.khat root=/dev/sda1 \
              blessing_mode=quick \
              cultural_mode=enabled \
              spiritual_protection=enabled
        
        initrd /boot/khat_initrd.img
        
        echo "Berkah singkat selesai!"
    }
}

# Memory test option
menuentry 'Memory Test (Tes Memori)' --class memtest {
    echo "Memulai tes memori dengan berkah..."
    echo "Tes memori untuk sistem yang stabil..."
    
    linux16 /boot/memtest86+.bin
    
    echo "Tes memori dimulai..."
}

# Shutdown option
menuentry 'Shutdown (Matikan Sistem)' --class shutdown {
    echo "Mematikan sistem dengan berkah..."
    echo "Terima kasih telah menggunakan Khatulistiwa OS"
    echo "Semoga bermanfaat untuk semua..."
    sleep 2
    halt
}

# Reboot option
menuentry 'Reboot (Restart Sistem)' --class reboot {
    echo "Restart sistem dengan berkah..."
    echo "Sampai jumpa lagi di Khatulistiwa OS..."
    sleep 2
    reboot
}

# Cultural footer message
echo ""
echo "==============================================================================="
echo "Gunakan panah atas/bawah untuk memilih, Enter untuk boot"
echo "Tekan 'e' untuk edit, 'c' untuk command line"
echo ""
echo "Semoga pilihan Anda membawa berkah!"
echo "Indonesia Bisa! Merdeka! Bhinneka Tunggal Ika!"
echo "==============================================================================="
