# ============================================================================
# grub.cfg - GRUB Configuration untuk Khatulistiwa OS
# Copyright (c) 2025 Dhafa Nazula Permadi & Team BIGCode By Cv Bintang Gumilang Group
# ============================================================================
# 
# GRUB configuration dengan tema budaya Indonesia:
# 1. Cultural boot menu dengan ornamen tradisional
# 2. Multi-language support (Indonesian/English)
# 3. Batik-inspired theme
# 4. Traditional Indonesian terminology
# 5. Recovery and advanced options

# Set timeout for menu
set timeout=10
set default=0

# Load cultural theme
set theme=/boot/grub/themes/khatulistiwa/theme.txt

# Set cultural background
if background_image /boot/grub/themes/khatulistiwa/background.png; then
    set color_normal=white/black
    set color_highlight=yellow/red
else
    set menu_color_normal=white/blue
    set menu_color_highlight=black/light-gray
fi

# Cultural menu colors (inspired by Indonesian flag and batik)
set menu_color_normal=white/red
set menu_color_highlight=yellow/brown

# Load fonts for Indonesian text
if loadfont /boot/grub/fonts/unicode.pf2; then
    set gfxmode=auto
    insmod gfxterm
    insmod vbe
    terminal_output gfxterm
fi

# Cultural welcome message
echo "=============================================="
echo "    KHATULISTIWA OS - SISTEM OPERASI INDONESIA"
echo "    Selamat datang di bootloader Khatulistiwa"
echo "    Welcome to Khatulistiwa bootloader"
echo "=============================================="

# Main menu entries
menuentry 'Khatulistiwa OS (Normal)' --class khatulistiwa --class gnu-linux --class gnu --class os {
    recordfail
    load_video
    gfxmode $linux_gfx_mode
    insmod gzio
    insmod part_msdos
    insmod ext2
    
    echo 'Memuat kernel Khatulistiwa...'
    echo 'Loading Khatulistiwa kernel...'
    
    linux /boot/khatkernel root=UUID=khatulistiwa-root ro quiet splash cultural_mode=on
    
    echo 'Memuat initial ramdisk...'
    echo 'Loading initial ramdisk...'
    
    initrd /boot/khat-initrd.img
}

menuentry 'Khatulistiwa OS (Mode Aman / Safe Mode)' --class khatulistiwa --class gnu-linux --class gnu --class os {
    recordfail
    load_video
    gfxmode $linux_gfx_mode
    insmod gzio
    insmod part_msdos
    insmod ext2
    
    echo 'Memuat kernel dalam mode aman...'
    echo 'Loading kernel in safe mode...'
    
    linux /boot/khatkernel root=UUID=khatulistiwa-root ro single nomodeset cultural_mode=off
    initrd /boot/khat-initrd.img
}

menuentry 'Khatulistiwa OS (Mode Budaya Penuh / Full Cultural Mode)' --class khatulistiwa --class gnu-linux --class gnu --class os {
    recordfail
    load_video
    gfxmode $linux_gfx_mode
    insmod gzio
    insmod part_msdos
    insmod ext2
    
    echo 'Memuat kernel dengan mode budaya penuh...'
    echo 'Loading kernel with full cultural mode...'
    
    linux /boot/khatkernel root=UUID=khatulistiwa-root ro quiet splash cultural_mode=full gamelan=on wayang=on batik=on
    initrd /boot/khat-initrd.img
}

menuentry 'Khatulistiwa OS (Mode Debug)' --class khatulistiwa --class gnu-linux --class gnu --class os {
    recordfail
    load_video
    gfxmode $linux_gfx_mode
    insmod gzio
    insmod part_msdos
    insmod ext2
    
    echo 'Memuat kernel dalam mode debug...'
    echo 'Loading kernel in debug mode...'
    
    linux /boot/khatkernel root=UUID=khatulistiwa-root ro debug loglevel=7 cultural_debug=on
    initrd /boot/khat-initrd.img
}

submenu 'Opsi Lanjutan / Advanced Options' {
    menuentry 'Khatulistiwa OS (Kernel Lama / Previous Kernel)' --class khatulistiwa --class gnu-linux --class gnu --class os {
        recordfail
        load_video
        gfxmode $linux_gfx_mode
        insmod gzio
        insmod part_msdos
        insmod ext2
        
        echo 'Memuat kernel versi sebelumnya...'
        echo 'Loading previous kernel version...'
        
        linux /boot/khatkernel.old root=UUID=khatulistiwa-root ro quiet splash
        initrd /boot/khat-initrd.old.img
    }
    
    menuentry 'Mode Pemulihan / Recovery Mode' --class khatulistiwa --class gnu-linux --class gnu --class os {
        recordfail
        load_video
        gfxmode $linux_gfx_mode
        insmod gzio
        insmod part_msdos
        insmod ext2
        
        echo 'Memuat mode pemulihan...'
        echo 'Loading recovery mode...'
        
        linux /boot/khatkernel root=UUID=khatulistiwa-root ro recovery nomodeset
        initrd /boot/khat-initrd.img
    }
    
    menuentry 'Test Memori / Memory Test (memtest86+)' {
        echo 'Memuat test memori...'
        echo 'Loading memory test...'
        
        linux16 /boot/memtest86+.bin
    }
    
    menuentry 'Boot dari USB / Boot from USB' {
        echo 'Mencoba boot dari USB...'
        echo 'Trying to boot from USB...'
        
        set root=(hd1)
        chainloader +1
    }
}

submenu 'Pengaturan Budaya / Cultural Settings' {
    menuentry 'Tema Batik Parang' --class khatulistiwa {
        set khat_theme=parang
        configfile /boot/grub/grub.cfg
    }
    
    menuentry 'Tema Batik Kawung' --class khatulistiwa {
        set khat_theme=kawung
        configfile /boot/grub/grub.cfg
    }
    
    menuentry 'Tema Batik Mega Mendung' --class khatulistiwa {
        set khat_theme=mega_mendung
        configfile /boot/grub/grub.cfg
    }
    
    menuentry 'Bahasa Indonesia' --class khatulistiwa {
        set lang=id_ID
        configfile /boot/grub/grub.cfg
    }
    
    menuentry 'English Language' --class khatulistiwa {
        set lang=en_US
        configfile /boot/grub/grub.cfg
    }
    
    menuentry 'Bahasa Jawa' --class khatulistiwa {
        set lang=jv_ID
        configfile /boot/grub/grub.cfg
    }
}

submenu 'Sistem Lain / Other Systems' {
    menuentry 'Windows (jika ada / if available)' {
        echo 'Mencari Windows...'
        echo 'Searching for Windows...'
        
        insmod part_msdos
        insmod ntfs
        set root=(hd0,msdos1)
        
        if [ -f /bootmgr ]; then
            echo 'Windows ditemukan, memuat...'
            echo 'Windows found, loading...'
            chainloader /bootmgr
        else
            echo 'Windows tidak ditemukan'
            echo 'Windows not found'
            sleep 3
        fi
    }
    
    menuentry 'Linux Lain / Other Linux' {
        echo 'Mencari distribusi Linux lain...'
        echo 'Searching for other Linux distributions...'
        
        insmod part_msdos
        insmod ext2
        
        # Try to find other Linux installations
        for dev in (hd0,*); do
            if [ -f $dev/boot/grub/grub.cfg ]; then
                echo "Ditemukan GRUB di $dev"
                echo "Found GRUB on $dev"
                set root=$dev
                configfile /boot/grub/grub.cfg
                break
            fi
        done
        
        echo 'Tidak ada distribusi Linux lain yang ditemukan'
        echo 'No other Linux distributions found'
        sleep 3
    }
}

# Shutdown and reboot options
menuentry 'Matikan Komputer / Shutdown' --class shutdown {
    echo 'Mematikan komputer...'
    echo 'Shutting down computer...'
    halt
}

menuentry 'Restart / Reboot' --class restart {
    echo 'Memulai ulang komputer...'
    echo 'Restarting computer...'
    reboot
}

# UEFI firmware settings (if available)
if [ "${grub_platform}" = "efi" ]; then
    menuentry 'Pengaturan UEFI / UEFI Firmware Settings' {
        echo 'Membuka pengaturan UEFI...'
        echo 'Opening UEFI settings...'
        fwsetup
    }
fi

# Cultural boot message function
function show_cultural_message {
    clear
    echo "╔══════════════════════════════════════════════════════════════════════════════╗"
    echo "║                        KHATULISTIWA OS - INDONESIA                           ║"
    echo "║                                                                              ║"
    echo "║    ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░    ║"
    echo "║    ░░                    GARUDA PANCASILA                    ░░              ║"
    echo "║    ░░                                                        ░░              ║"
    echo "║    ░░  Sistem Operasi Indonesia dengan Budaya Nusantara     ░░              ║"
    echo "║    ░░  Indonesian Operating System with Archipelago Culture ░░              ║"
    echo "║    ░░                                                        ░░              ║"
    echo "║    ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░    ║"
    echo "║                                                                              ║"
    echo "║  Gunakan ↑↓ untuk navigasi, Enter untuk memilih                             ║"
    echo "║  Use ↑↓ to navigate, Enter to select                                        ║"
    echo "╚══════════════════════════════════════════════════════════════════════════════╝"
    sleep 2
}

# Show cultural message on boot
show_cultural_message

# Set cultural variables based on theme
if [ "$khat_theme" = "parang" ]; then
    set color_normal=white/red
    set color_highlight=yellow/brown
elif [ "$khat_theme" = "kawung" ]; then
    set color_normal=white/blue
    set color_highlight=yellow/green
elif [ "$khat_theme" = "mega_mendung" ]; then
    set color_normal=white/cyan
    set color_highlight=yellow/blue
fi

# Load additional modules for cultural features
insmod png
insmod jpeg
insmod gfxmenu

# Set up cultural hotkeys
# F1 - Help in Indonesian
# F2 - Help in English
# F3 - Cultural information
# F4 - System information

# Cultural help text
set help_id="
Bantuan Khatulistiwa OS:
- Gunakan panah atas/bawah untuk navigasi
- Tekan Enter untuk memilih
- Tekan 'e' untuk edit perintah boot
- Tekan 'c' untuk command line GRUB
- F1: Bantuan Indonesia
- F2: English Help
- F3: Informasi Budaya
- F4: Informasi Sistem
"

set help_en="
Khatulistiwa OS Help:
- Use up/down arrows to navigate
- Press Enter to select
- Press 'e' to edit boot commands
- Press 'c' for GRUB command line
- F1: Indonesian Help
- F2: English Help
- F3: Cultural Information
- F4: System Information
"

set cultural_info="
Informasi Budaya Khatulistiwa OS:
- Tema Batik: Parang, Kawung, Mega Mendung
- Suara Gamelan: Terintegrasi dalam sistem
- Animasi Wayang: Tersedia di desktop
- Bahasa: Indonesia, English, Jawa, Sunda
- Ornamen: Garuda, Motif Tradisional
"

# End of GRUB configuration
